<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <!--<![endif]-->
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        
        <div class="wholeClock">
        <h2>Stoppuhr</h2>
        <div class="clockElement" >
            <h1 id="output"></h1>
        </div>

        
        
        <input id="startButton" type="button" class="button" value="Start">
        <input id="stopButton" type="button" class="button" value="Stop">
        <input id="resetButton" type="button" class="button" value="ZurÃ¼cksetzen">
        <input id="timeButton" type="button" class="button" value="Zeit">
        <input id="lapButton" type="button" class="button" value="Runde">
       
       

        </div>
        <div id="showResults" class="showResults">
        <table id="tableResults">
         

        </table>
        </div>

        <script>
            var outputElement = document.getElementById("output");
            var showResultsTable = document.getElementById("showResults");
            var tableResults = document.getElementById("tableResults");

            var startButton =   document.getElementById("startButton");
            var resetButton =   document.getElementById("resetButton");
            var timeButton =     document.getElementById("timeButton");
            var stopButton =     document.getElementById("stopButton");
            var lapButton =     document.getElementById("lapButton");

            startButton.addEventListener("click", startCounting );
            resetButton.addEventListener("click", resetCounter);
            timeButton.addEventListener("click", getCurrentTimeOnDisplay);
            stopButton.addEventListener("click", stopTime);
            lapButton.addEventListener("click",  function() {getCurrentTimeOnDisplay(true);}, );

            setInterval(Timer,100);

            var startValue = 0;
            var clockEnabled = false;
            var stoppButtonActivated = false;
            var resultsCounter = 1;
            var resetButtonCounter = 0;
            var elapsedTime = 0;
            var savedValue = 0;
            var duration = 0;
            var currentDate = 0;
            var isStopped = false;

            function stopTime()
            {
                stoppButtonActivated = true;
                isStopped =true;
            }

            function Timer()
            {
                
               
                if(clockEnabled && !stoppButtonActivated)
                {
                    currentDate = new Date();
                    duration = new Date(currentDate - startValue + savedValue);
                    elapsedTime = addZero(duration.getMinutes()) + ":" + addZero(duration.getSeconds()) + ":" + addZeroMs(duration.getMilliseconds());
               
                    outputElement.innerHTML = elapsedTime;
                }
                else if (clockEnabled && stoppButtonActivated)
                {
                    outputElement.innerHTML = elapsedTime;
                    if(isStopped)
                    {
                        savedValue=currentDate-startValue+savedValue;
                        isStopped=false;
                    }
                }
                else
                {
                    outputElement.innerHTML = "00:00:000";
                }
            }

            function addZero(i) 
            {
                if (i < 10) 
                {
                i = "0" + i;
                }
                return i;
            }

            function addZeroMs(i) 
            {
                if (i < 10) 
                {
                i = "00" + i;
                }
                else if(i >= 10 && i < 100)
                {
                i = "0" + i;
                }
                return i;
            }

            function startCounting()
            {
                startValue = Date.now();
                
                resetButtonCounter = 0

                clockEnabled =          true;
                stoppButtonActivated =  false;
            }

            function resetCounter()
            {
                clockEnabled = false;

                if(resetButtonCounter>0)
                {
                    while (tableResults.lastElementChild) 
                    {
                    tableResults.removeChild(tableResults.lastElementChild);
                    }
                    resetButtonCounter=0;
                    resultsCounter = 1;
                    savedValue = 0;
                    stoppButtonActivated = false;
                }
                else
                {
                    resetButtonCounter++
                }
            }

            function getCurrentTimeOnDisplay(round=false)
            {
                
                var timeFromDisplay = document.createTextNode(outputElement.innerHTML);
                var resultsCounterValue = document.createTextNode(resultsCounter);
                
                var element = document.createElement("tr");
                var elementLine = document.createElement("td");
                var elementCounter = document.createElement("td");

               
                elementLine.appendChild(timeFromDisplay);
                elementCounter.appendChild(resultsCounterValue);

                element.appendChild(elementCounter);
                element.appendChild(elementLine);
                
                tableResults.append(element);

                if(round==true)
                {
                    startValue = Date.now();
                    savedValue = 0;
                }

                resultsCounter++;
            }



        </script>
    </body>
</html>




